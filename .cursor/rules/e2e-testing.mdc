---
description: E2E testing conventions using Playwright and Cucumber (Gherkin)
globs: e2e/**/*
alwaysApply: false
---

# E2E Testing Guide

End-to-end tests for Meeting Plunger using Playwright and Cucumber (Gherkin).

## Running Tests

All commands should be run from the project root with the `nix develop -c` prefix:

```bash
# Run all tests (headless)
nix develop -c pnpm e2e

# Run tests in headed mode (see the browser)
nix develop -c pnpm e2e:headed

# Run tests in debug mode
nix develop -c pnpm e2e:debug
```

**Note**: Both backend and client services must be running. Use `nix develop -c pnpm sut` to start both services.

## Project Structure

```
e2e/
├── features/           # Gherkin feature files
│   ├── health-check.feature
│   └── client-ui.feature
├── steps/              # Step definitions
│   ├── health-check.steps.js
│   └── client-ui.steps.js
├── support/            # Support files
│   └── world.js       # Custom world with Playwright setup
└── package.json        # Dependencies and test scripts
```

## Writing Feature Files

Feature files use Gherkin syntax in `e2e/features/`:

```gherkin
Feature: My Feature
  As a user
  I want to do something
  So that I can achieve a goal

  Scenario: Test scenario
    Given some precondition
    When I perform an action
    Then I should see the result
```

## Writing Step Definitions

Step definitions are JavaScript files in `e2e/steps/`:

```javascript
import { Given, When, Then } from '@cucumber/cucumber';
import { expect } from '@playwright/test';

Given('some precondition', async function () {
  // Setup code
});

When('I perform an action', async function () {
  // Action code using this.page
});

Then('I should see the result', async function () {
  // Assertion using expect
});
```

## Available Context

In step definitions, you have access to:

- `this.browser` - Playwright browser instance
- `this.context` - Playwright browser context
- `this.page` - Playwright page instance
- `this.response` - Last HTTP response (if any)

## Reports

After running tests, HTML and JSON reports are generated in `e2e/reports/`.
