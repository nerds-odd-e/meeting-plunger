---
description: E2E testing conventions using Playwright and Cucumber (Gherkin)
globs: e2e/**/*
alwaysApply: false
---

# E2E Testing Guide

End-to-end tests for Meeting Plunger using Playwright and Cucumber (Gherkin).

## Running Tests

All commands should be run from the project root with the `nix develop -c` prefix:

```bash
# Run all tests (headless)
nix develop -c pnpm e2e

# Run tests in headed mode (see the browser)
nix develop -c pnpm e2e:headed

# Run tests in debug mode
nix develop -c pnpm e2e:debug
```

**Note**: Both backend and client services must be running. Use `nix develop -c pnpm sut` to start both services.

## Project Structure

```
e2e/
├── features/           # Gherkin feature files
│   ├── health-check.feature
│   └── client-ui.feature
├── steps/              # Step definitions (TypeScript)
│   ├── health-check.steps.ts
│   └── client-ui.steps.ts
├── support/            # Support files
│   └── world.ts       # Custom world with Playwright setup
├── tsconfig.json       # TypeScript configuration
└── package.json        # Dependencies and test scripts
```

## Writing Feature Files

Feature files use Gherkin syntax in `e2e/features/`:

```gherkin
Feature: My Feature
  As a user
  I want to do something
  So that I can achieve a goal

  Scenario: Test scenario
    Given some precondition
    When I perform an action
    Then I should see the result
```

## Writing Step Definitions

Step definitions are TypeScript files in `e2e/steps/`:

```typescript
import { Given, When, Then } from '@cucumber/cucumber';
import { expect } from '@playwright/test';
import { CustomWorld } from '../support/world.js';

Given('some precondition', async function (this: CustomWorld) {
  // Setup code
});

When('I perform an action', async function (this: CustomWorld) {
  // Action code using this.page
  if (!this.page) throw new Error('Page is not initialized');
  await this.page.goto('http://example.com');
});

Then('I should see the result', async function (this: CustomWorld) {
  // Assertion using expect
  if (!this.page) throw new Error('Page is not initialized');
  await expect(this.page.locator('text=Result')).toBeVisible();
});
```

## Available Context

In step definitions (via `this: CustomWorld`), you have access to:

- `this.browser` - Playwright browser instance (Browser | null)
- `this.context` - Playwright browser context (BrowserContext | null)
- `this.page` - Playwright page instance (Page | null)
- `this.response` - Last HTTP response (APIResponse | null)
- `this.baseUrl` - Optional base URL (string | undefined)

## Reports

After running tests, HTML and JSON reports are generated in `e2e/reports/`.
